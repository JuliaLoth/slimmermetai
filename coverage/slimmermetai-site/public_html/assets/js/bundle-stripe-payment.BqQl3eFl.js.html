
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for slimmermetai-site/public_html/assets/js/bundle-stripe-payment.BqQl3eFl.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../../index.html">All files</a> / <a href="index.html">slimmermetai-site/public_html/assets/js</a> bundle-stripe-payment.BqQl3eFl.js</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >const c={publishableKey:null,apiUrl:window.location.origin+"/api/stripe",configUrl:window.location.origin+"/api/stripe/config",initialized:!1,init:function(){if(this.initialized){console.warn("StripePayment is al geïnitialiseerd. Overslaan.");return}this.initialized=!0,console.log("Stripe Payment wordt geïnitialiseerd"),this.getStripeConfig().then(()=&gt;{if(!this.publishableKey)throw new Error("Publishable key ontbreekt, initialisatie afgebroken.");this.loadStripeJs(),this.replaceCheckoutButton()}).catch(n=&gt;{console.error("Fout bij initialiseren Stripe Payment:",n);const i=document.getElementById("checkout-btn");i&amp;&amp;(i.disabled=!0),typeof showNotification=="function"&amp;&amp;showNotification("Het betalingssysteem is momenteel niet beschikbaar. Probeer het later opnieuw of neem contact op met de beheerder.","error")})},getStripeConfig:function(){return console.log("Ophalen Stripe configuratie van:",this.configUrl),new Promise((n,i)=&gt;{fetch(this.configUrl,{method:"GET",headers:{"Cache-Control":"no-cache"}}).then(t=&gt;{if(!t.ok)throw console.error("Server antwoord fout:",t.status,t.statusText),new Error(`Kon Stripe-configuratie niet ophalen (status ${t.status}).`);console.log("Response headers:",t.headers);const o=t.headers.get("content-type");return console.log("Content-Type header:",o),t.text().then(e=&gt;{if(e.trim().startsWith("&lt;!DOCTYPE html&gt;")||e.trim().startsWith("&lt;html"))throw console.error("HTML ontvangen in plaats van JSON. Waarschijnlijk een toegangsprobleem:",e.substring(0,500)),new Error("Onverwachte HTML-respons ontvangen in plaats van JSON.");try{return JSON.parse(e)}catch{throw console.error("Configuratie kon niet geparsed worden als JSON."),new Error("Configuratie kon niet geparsed worden als JSON.")}})}).then(t=&gt;{console.log("Ontvangen configuratie data:",t);let o=null;if(t.success&amp;&amp;t.data){const e=t.data;e.publishableKey?o=e.publishableKey:e.public_key?o=e.public_key:e.stripe_key&amp;&amp;(o=e.stripe_key)}else t.publishableKey?o=t.publishableKey:t.config_variables&amp;&amp;t.config_variables.STRIPE_PUBLIC_KEY?(o=t.config_variables.STRIPE_PUBLIC_KEY,console.log("Sleutel gevonden in config_variables")):t.public_key?o=t.public_key:t.stripe_key&amp;&amp;(o=t.stripe_key);o?(this.publishableKey=o,console.log("Stripe publishable key opgehaald van server:",o),n(t)):(console.error("Volledige response data:",JSON.stringify(t,null,2)),i(new Error("Geen publishableKey gevonden in server-respons.")))}).catch(t=&gt;{console.error("Fout bij ophalen Stripe configuratie:",t),i(t)})})},loadStripeJs:function(){if(document.getElementById("stripe-js")){console.log("Stripe.js is al geladen");return}const n=document.createElement("script");n.id="stripe-js",n.src="https://js.stripe.com/v3/",n.async=!0,document.head.appendChild(n),console.log("Stripe.js script toegevoegd")},replaceCheckoutButton:function(){const n=document.getElementById("checkout-btn");if(!n){console.log("Checkout knop niet gevonden");return}const i=n.cloneNode(!0);n.parentNode.replaceChild(i,n),i.addEventListener("click",this.handleCheckout.bind(this)),console.log("Checkout knop event handler vervangen")},handleCheckout:async function(n){n.preventDefault();const i=document.getElementById("checkout-btn"),t=i.textContent;i.disabled=!0,i.innerHTML='&lt;div class="spinner"&gt;&lt;/div&gt; Bezig met laden...';try{if(!window.Stripe&amp;&amp;(this.loadStripeJs(),await new Promise(r=&gt;setTimeout(r,1e3)),!window.Stripe))throw new Error("Stripe.js is niet geladen. Vernieuw de pagina en probeer het opnieuw.");if((!this.publishableKey||!this.publishableKey.startsWith("pk_"))&amp;&amp;(console.warn("Geen geldige Stripe publishable key, probeer nogmaals de configuratie op te halen..."),await this.getStripeConfig(),!this.publishableKey||!this.publishableKey.startsWith("pk_")))throw new Error("Publishable key ontbreekt of is ongeldig.");const o=this.prepareCheckoutData();console.log("Prepared checkout data:",o);const e=await this.createCheckoutSession(o);if(console.log("Checkout session created:",e),e.error&amp;&amp;e.error===!0)throw console.error("Stripe API fout:",e.message||"Onbekende fout"),showNotification("Er is een fout met de Stripe API. Neem contact op met de beheerder: "+(e.message||"Onbekende fout"),"error"),new Error("Stripe API fout: "+(e.message||"Onbekende fout"));if(e&amp;&amp;e.id)this.redirectToCheckout(e.id);else throw new Error("Geen geldig Stripe sessie ID ontvangen. Ontvangen: "+JSON.stringify(e))}catch(o){console.error("Fout bij het starten van de betaling:",o);let e=o.message||"Onbekende fout";e.includes("API Key")||e.includes("API sleutel")?e="Er is een probleem met de betaaldienst. Neem contact op met de beheerder.":e.includes("Winkelwagen is leeg")?e="Je winkelwagen is leeg. Voeg eerst producten toe.":e.includes("body stream already read")&amp;&amp;(e="Er is een technisch probleem met de betaaldienst. Vernieuw de pagina en probeer het opnieuw."),showNotification("Er is een fout opgetreden bij het starten van de betaling: "+e,"error"),i.disabled=!1,i.textContent=t}},prepareCheckoutData:function(){const n=Cart.getItems();if(!n||n.length===0)throw showNotification("Je winkelwagen is leeg","error"),new Error("Winkelwagen is leeg");const i=n.map(e=&gt;({price_data:{currency:"eur",product_data:{name:e.name||"Product",description:e.type||"Product",images:e.img?[new URL(e.img,window.location.origin).href]:[]},unit_amount:Math.round((e.price||0)*100)},quantity:parseInt(e.quantity||1,10)}));console.log("Prepared line_items:",i);let t=null;try{t=localStorage.getItem("userEmail")}catch{console.log("Geen email gevonden in localStorage")}const o={line_items:i,success_url:window.location.origin+"/betaling-succes",cancel_url:window.location.origin+"/winkelwagen",mode:"payment"};return t&amp;&amp;(o.customer_email=t),o.metadata={cart_id:localStorage.getItem("cartId")||Date.now().toString()},o},createCheckoutSession:async function(n){try{console.log("Testen van API verbinding...");const i=window.location.origin+"/api/stripe/simple-test.php";try{console.log("Test API endpoint met GET verzoek:",i);const e=await fetch(i,{method:"GET",headers:{Accept:"text/plain","Cache-Control":"no-cache"}});console.log("Test API response status:",e.status);const r=await e.text();console.log("Test API response text (eerste 100 karakters):",r.substring(0,100));let s=!1;if(e.ok&amp;&amp;!r.trim().startsWith("&lt;?php")?(console.log("API test succesvol (server gaf geen PHP-code terug)"),s=!0):console.warn("API test niet succesvol. Status:",e.status,"Response begint met:",r.substring(0,5)),!s)return console.warn("API test niet succesvol, gebruik alternatieve methode"),await this.createCheckoutSessionAlternative(n)}catch(e){return console.error("API test fout:",e),console.warn("Gebruik alternatieve checkout methode"),await this.createCheckoutSessionAlternative(n)}const t=window.location.origin+"/api/stripe/checkout";if(console.log("Aanmaken checkout sessie met URL:",t),!n||!n.line_items||n.line_items.length===0)throw console.error("Ongeldige sessionData",n),new Error("Ongeldige checkout data. Winkelwagen is mogelijk leeg.");const o=JSON.stringify(n);console.log("Sessie data (eerste 100 karakters):",o.substring(0,100));try{console.log("Uitvoeren POST verzoek naar primair API endpoint...");let e=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache"},body:o});console.log("Primair API response status:",e.status);const r=await e.text();if(console.log("Primair API response text (eerste 100 karakters):",r.substring(0,100)),r.trim().startsWith("&lt;!DOCTYPE html&gt;")||r.trim().startsWith("&lt;html")||r.trim().startsWith("&lt;?php"))throw console.error("PHP of HTML code ontvangen in plaats van JSON. Probeer alternatieve endpoint..."),new Error("PHP of HTML code ontvangen in plaats van JSON");if(!e.ok)throw console.error(`API fout: ${e.status} ${e.statusText}. Details: ${r.substring(0,200)}`),e.status===405&amp;&amp;console.error("405 Method Not Allowed: Het endpoint accepteert mogelijk alleen POST verzoeken"),new Error(`API fout: ${e.status} ${e.statusText}`);try{const s=JSON.parse(r);console.log("Checkout session response:",s);let a=null,l=null;if(s.success&amp;&amp;s.data&amp;&amp;s.data.session?(a=s.data.session.id,l=s.data.session.url,console.log("Gevonden session in data.data.session:",a)):s.data&amp;&amp;s.data.id?(a=s.data.id,l=s.data.url,console.log("Gevonden session in data (legacy):",a)):s.id&amp;&amp;(a=s.id,l=s.url,console.log("Gevonden session direct (legacy):",a)),!a)throw console.error("Volledige response data:",JSON.stringify(s,null,2)),new Error("Geen geldig Stripe sessie ID ontvangen");return{id:a,url:l}}catch(s){throw console.error("Kon de API response niet als JSON parsen:",s),console.error("Raw API response:",r),new Error("Ongeldige response van de Stripe API: "+r.substring(0,100))}}catch(e){return console.error("Fout bij primair API endpoint:",e),await this.createCheckoutSessionAlternative(n)}}catch(i){throw console.error("API fout:",i),i}},createCheckoutSessionAlternative:async function(n){console.log("Probeer fallback endpoint in hoofdmap...");const i=window.location.origin+"/api/stripe/checkout";if(!n||!n.line_items||n.line_items.length===0)return console.error("Ongeldige sessionData voor fallback",n),this.createDirectStripeSession(n||{line_items:[]});const t=JSON.stringify(n);console.log("Verzenden naar fallback endpoint:",i),console.log("Met data:",t);try{console.log("Uitvoeren POST request naar fallback endpoint...");let o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache"},body:t});console.log("Fallback response status:",o.status);const e=await o.text();if(console.log("Fallback response text (eerste 100 karakters):",e.substring(0,100)),e.trim().startsWith("&lt;!DOCTYPE html&gt;")||e.trim().startsWith("&lt;html")||e.trim().startsWith("&lt;?php"))return console.error("PHP of HTML ontvangen van fallback endpoint. Directe Stripe integratie is nodig."),console.log("Beide API endpoints falen, gebruik directe Stripe checkout..."),this.createDirectStripeSession(n);if(!o.ok)return console.error(`Fallback endpoint fout: ${o.status}. Details: ${e.substring(0,200)}`),o.status===405&amp;&amp;console.error("405 Method Not Allowed: Het endpoint accepteert alleen POST verzoeken"),this.createDirectStripeSession(n);try{const r=JSON.parse(e);console.log("Fallback checkout session response:",r);let s=null,a=null;return r.success&amp;&amp;r.data&amp;&amp;r.data.session?(s=r.data.session.id,a=r.data.session.url,console.log("Gevonden session in fallback data.data.session:",s)):r.data&amp;&amp;r.data.id?(s=r.data.id,a=r.data.url,console.log("Gevonden session in fallback data (legacy):",s)):r.id&amp;&amp;(s=r.id,a=r.url,console.log("Gevonden session direct in fallback (legacy):",s)),s?{id:s,url:a}:(console.error("Geen geldig Stripe sessie ID ontvangen van fallback endpoint"),console.error("Volledige fallback response data:",JSON.stringify(r,null,2)),this.createDirectStripeSession(n))}catch(r){return console.error("Kon fallback response niet als JSON parsen:",r,"Response tekst:",e),this.createDirectStripeSession(n)}}catch(o){return console.error("Fout bij alternatieve checkout methode:",o),this.createDirectStripeSession(n)}},createDirectStripeSession:function(n){if(console.log("Gebruik directe Stripe checkout als laatste redmiddel"),!window.Stripe)return console.error("Stripe.js is niet beschikbaar voor directe checkout. Poging tot laden..."),this.loadStripeJs(),{id:"direct_"+Date.now(),direct_checkout:!0,items:n.line_items,fallback_method:"direct_redirect"};let i="SlimmerMetAI Product",t=0;try{if(n.line_items&amp;&amp;n.line_items.length&gt;0){const o=n.line_items[0];o.price_data&amp;&amp;o.price_data.product_data&amp;&amp;(i=o.price_data.product_data.name||i),o.price_data&amp;&amp;o.price_data.unit_amount&amp;&amp;(t=o.price_data.unit_amount)}}catch(o){console.error("Fout bij verwerken van product info:",o)}return console.log("Directe checkout met product:",i,"en prijs:",t),(!t||t&lt;=0)&amp;&amp;(t=2999),{id:"direct_"+Date.now(),direct_checkout:!0,items:n.line_items,product_name:i,product_price:t,fallback_method:"direct_checkout"}},redirectToCheckout:function(n){if(n&amp;&amp;n.startsWith("cs_test_mock_")){console.log("[StripePayment] Mock session detected:",n),console.log("[StripePayment] Redirecting directly to success page for mock session");const t=window.location.origin+"/betaling-succes?mock=true&amp;session_id="+n;console.log("[StripePayment] Mock success URL:",t),window.location.href=t;return}if(typeof showNotification=="function"&amp;&amp;showNotification("Je wordt doorgestuurd naar de betaalpagina...","info"),n.startsWith("direct_")){this.redirectToDirectCheckout();return}const i=setInterval(()=&gt;{if(window.Stripe){clearInterval(i);try{if(console.log("Redirecting to Stripe checkout with session ID:",n),console.log("Using publishable key:",this.publishableKey),!this.publishableKey||!this.publishableKey.startsWith("pk_"))throw new Error("Ongeldige Stripe publishable key.");Stripe(this.publishableKey).redirectToCheckout({sessionId:n}).then(function(o){if(o.error){console.error("Stripe checkout fout:",o.error),typeof showNotification=="function"&amp;&amp;showNotification("Fout bij doorsturen naar betaalpagina: "+o.error.message,"error");const e=document.getElementById("checkout-btn");e&amp;&amp;(e.disabled=!1,e.textContent="Afrekenen")}}).catch(function(o){console.error("Onverwachte fout:",o),typeof showNotification=="function"&amp;&amp;showNotification("Er is een onverwachte fout opgetreden: "+o.message,"error");const e=document.getElementById("checkout-btn");e&amp;&amp;(e.disabled=!1,e.textContent="Afrekenen")})}catch(t){console.error("Fout bij initialiseren Stripe:",t),typeof showNotification=="function"&amp;&amp;showNotification("Er is een fout opgetreden bij het initialiseren van Stripe: "+t.message,"error");const o=document.getElementById("checkout-btn");o&amp;&amp;(o.disabled=!1,o.textContent="Afrekenen")}}},100);setTimeout(()=&gt;{if(clearInterval(i),!window.Stripe){console.error("Stripe.js kon niet worden geladen binnen de time-out periode"),showNotification("Stripe.js kon niet worden geladen. Controleer je internetverbinding en probeer het opnieuw.","error");const t=document.getElementById("checkout-btn");t&amp;&amp;(t.disabled=!1,t.textContent="Afrekenen")}},5e3)},redirectToDirectCheckout:function(){if(console.log("Gebruik directe Stripe checkout redirect"),window.Stripe)try{const n=Stripe(this.publishableKey),i=Cart.getItems()||[];let t=[];i.length&gt;0&amp;&amp;(t=i.map(o=&gt;({price:o.stripePriceId||null,quantity:parseInt(o.quantity||1,10)})).filter(o=&gt;o.price)),t.length===0?(console.warn("Geen geldige Price ID's gevonden voor directe checkout, gebruik fallback product."),t=[{price_data:{currency:"eur",product_data:{name:"SlimmerMetAI Bestelling",description:"Je bestelling bij SlimmerMetAI"},unit_amount:Cart.calculateTotal()*100||2999},quantity:1}]):console.log("Gebruik Price ID's voor directe checkout:",t),n.redirectToCheckout({mode:"payment",lineItems:t,successUrl:window.location.origin+"/betaling-succes?direct_fallback=true",cancelUrl:window.location.origin+"/winkelwagen?direct_fallback=true"}).then(function(o){o.error&amp;&amp;(console.error("Directe Stripe checkout fout:",o.error),showNotification("Fout bij doorsturen naar betaalpagina: "+o.error.message,"error"),c.createDynamicPaymentPage())}).catch(function(o){console.error("Fout bij directe Stripe checkout:",o),c.createDynamicPaymentPage()})}catch(n){console.error("Fout bij directe Stripe checkout:",n),c.createDynamicPaymentPage()}else c.createDynamicPaymentPage()},createDynamicPaymentPage:function(){console.log("Maak dynamische betaalpagina aan..."),typeof showNotification=="function"&amp;&amp;showNotification("We bereiden je betaling voor, een moment geduld a.u.b...","info"),console.log("Poging om dynamische checkout sessie aan te maken via server-api..."),this.tryAllCheckoutEndpoints([window.location.origin+"/api/stripe/checkout"])},tryAllCheckoutEndpoints:function(n,i=0){if(i&gt;=n.length){console.error("Alle checkout endpoints zijn mislukt"),typeof showNotification=="function"&amp;&amp;showNotification("Er is een probleem met de betaalpagina. Probeer het later opnieuw of neem contact op met onze klantenservice.","error");const e=document.getElementById("checkout-btn");e&amp;&amp;(e.disabled=!1,e.textContent="Afrekenen");return}const t=n[i];console.log(`Probeer checkout endpoint ${i+1}/${n.length}: ${t}`);const o={mode:"payment",line_items:[{price_data:{currency:"eur",product_data:{name:"SlimmerMetAI Product"},unit_amount:2999},quantity:1}],success_url:window.location.origin+"/betaling-succes.html",cancel_url:window.location.origin+"/winkelwagen",emergency_fallback:!0};fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(e=&gt;{if(console.log(`Endpoint ${t} response status: ${e.status}`),!e.ok)throw console.warn(`Endpoint ${t} gaf status ${e.status}`),new Error(`HTTP status ${e.status}`);return e.text().then(r=&gt;{if(r.trim().startsWith("&lt;!DOCTYPE html&gt;")||r.trim().startsWith("&lt;html"))throw console.warn(`Endpoint ${t} gaf HTML terug in plaats van JSON`,r.substring(0,200)),new Error("Server gaf HTML terug in plaats van JSON");try{return JSON.parse(r)}catch{throw console.warn(`Endpoint ${t} gaf geen geldige JSON terug`,r.substring(0,200)),new Error("Server gaf geen geldige JSON terug")}})}).then(e=&gt;{if(console.log(`Checkout sessie ontvangen van ${t}:`,e),e.success&amp;&amp;e.id)this.redirectToCheckout(e.id);else if(e.url)console.log("Directe checkout URL ontvangen:",e.url),window.location.href=e.url;else throw new Error(e.message||"Geen geldig sessie ID of URL ontvangen")}).catch(e=&gt;{console.warn(`Endpoint ${t} mislukt:`,e),this.tryAllCheckoutEndpoints(n,i+1)})},handlePaymentStatus:function(){const i=new URLSearchParams(window.location.search).get("session_id");i&amp;&amp;fetch(this.apiUrl+"/check-payment-status.php?session_id="+i).then(t=&gt;t.json()).then(t=&gt;{t.status==="success"?(typeof Cart&lt;"u"&amp;&amp;Cart.resetCart(!1),showNotification("Je betaling is succesvol verwerkt!","success")):showNotification("De status van je betaling is: "+t.status,"info")}).catch(t=&gt;{console.error("Fout bij het controleren van de betaalstatus:",t)})}};window.StripePayment=c;document.addEventListener("DOMContentLoaded",function(){document.querySelector(".cart-section")&amp;&amp;c.init(),(window.location.pathname.includes("betaling-succes")||window.location.pathname.includes("betaling-voltooid"))&amp;&amp;c.handlePaymentStatus(</span></span>)});</span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-06-06T15:06:22.361Z
            </div>
        <script src="../../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../../sorter.js"></script>
        <script src="../../../../block-navigation.js"></script>
    </body>
</html>
    